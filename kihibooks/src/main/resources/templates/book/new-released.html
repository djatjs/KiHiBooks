<!DOCTYPE html>
<html 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout.html}">

<head>
	<meta charset="UTF-8">
	<title>í‚¤íˆ ì‹ ì‘</title>
	<style>
		.filter-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 20px;
			border-bottom: 1px solid #ddd;
		}
		.filter-left, .filter-right {
			display: flex;
			gap: 12px;
		}
		.filter-btn {
			padding: 6px 12px;
			border: 1px solid #ccc;
			border-radius: 16px;
			background-color: #f9f9f9;
			cursor: pointer;
			font-size: 14px;
			color: #333;
			text-decoration: none;
		}
		.filter-btn.active {
			background-color: #111;
			color: #fff;
			border-color: #111;
		}
		.book-grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 20px;
			padding: 20px;
		}
		.book-item {
			border: 1px solid #eee;
			border-radius: 8px;
			padding: 12px;
			background-color: #fff;
		}
		.book-item img {
			width: 100%;
			height: auto;
			border-radius: 4px;
		}
		.book-title {
			margin-top: 8px;
			font-size: 16px;
			font-weight: bold;
		}
	</style>
</head>

<body>
	<div layout:fragment="content" class="container">
		<h2 style="padding-left: 20px; padding-top: 20px;">ì‹ ì‘ ì›¹ì†Œì„¤</h2>

		<!-- í•„í„° í—¤ë” -->
		<div class="filter-header">
			<!-- ì¢Œì¸¡: ì¸ê¸°ìˆœ / ìµœì‹ ìˆœ -->
			<div class="filter-left">
				<a th:href="@{/book/new-released(order='popular', adult=${adult}, fin=${fin})}"
				   th:classappend="${order == 'popular'} ? 'active'" class="filter-btn">ì¸ê¸°ìˆœ</a>
				<a th:href="@{/book/new-released(order='latest', adult=${adult}, fin=${fin})}"
				   th:classappend="${order == 'latest'} ? 'active'" class="filter-btn">ìµœì‹ ìˆœ</a>
			</div>

			<!-- ìš°ì¸¡: ì„±ì¸ì‘í’ˆë§Œ / ì„±ì¸ì‘í’ˆ ì œì™¸ -->
			<form id="filterForm" method="get" action="/book/new-released" class="filter-right">
				<input type="hidden" name="order" th:value="${order}" />

				<label class="filter-btn">
					<input type="checkbox" id="adultTrue" value="true"
						   th:checked="${adult == true}" /> ì„±ì¸ì‘í’ˆë§Œ
				</label>

				<label class="filter-btn">
					<input type="checkbox" id="adultFalse" value="false"
						   th:checked="${adult == false}" /> ì„±ì¸ì‘í’ˆ ì œì™¸
				</label>
			</form>
		</div>

		<!-- ë„ì„œ ëª©ë¡ -->
		<div class="book-grid">
			<div class="book-item" th:each="book : ${bookList}">
				<img th:src="@{'/resources/static/covers/cover' + ${book.bo_code} + '.png'}"
					 th:alt="${book.bo_title}" />
				<div class="book-title" th:text="${book.bo_title}">ë„ì„œ ì œëª©</div>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener("DOMContentLoaded", () => {
			console.log("ğŸ”¥ í•„í„° ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¨");
			const form = document.getElementById("filterForm");
			const adultTrue = document.getElementById("adultTrue");
			const adultFalse = document.getElementById("adultFalse");

			const updateAndSubmit = (event) => {
				console.log("âœ… í•„í„° í´ë¦­ë¨:", event.target.id);

				// ë™ì‹œì— ë‘ ê°œ ì²´í¬ ë°©ì§€
				if (adultTrue.checked && adultFalse.checked) {
					if (event.target === adultTrue) {
						adultFalse.checked = false;
					} else {
						adultTrue.checked = false;
					}
				}

				// ëª¨ë“  name ì œê±°
				adultTrue.removeAttribute("name");
				adultFalse.removeAttribute("name");

				// ì²´í¬ëœ ìª½ë§Œ name ë¶€ì—¬
				if (adultTrue.checked) {
					adultTrue.setAttribute("name", "adult");
				} else if (adultFalse.checked) {
					adultFalse.setAttribute("name", "adult");
				}

				console.log("ğŸ“¤ submit adult=", 
					adultTrue.checked ? "true" : 
					adultFalse.checked ? "false" : "ì—†ìŒ"
				);

				form.submit(); // requestSubmit ë„ ê°€ëŠ¥
			};

			adultTrue.addEventListener("change", updateAndSubmit);
			adultFalse.addEventListener("change", updateAndSubmit);
		});
	</script>
</body>
</html>
