<!DOCTYPE html>
<html 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout.html}">

<head>
	<meta charset="UTF-8">
	<title>키히 신작</title>
	<style>
		.filter-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 20px;
			border-bottom: 1px solid #ddd;
		}
		.filter-left, .filter-right {
			display: flex;
			gap: 12px;
		}
		.filter-btn {
			padding: 6px 12px;
			border: 1px solid #ccc;
			border-radius: 16px;
			background-color: #f9f9f9;
			cursor: pointer;
			font-size: 14px;
			color: #333;
			text-decoration: none;
		}
		.filter-btn.active {
			background-color: #111;
			color: #fff;
			border-color: #111;
		}
		.book-grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 20px;
			padding: 20px;
		}
		.book-item {
			border: 1px solid #eee;
			border-radius: 8px;
			padding: 12px;
			background-color: #fff;
		}
		.book-item img {
			width: 100%;
			height: auto;
			border-radius: 4px;
		}
		.book-title {
			margin-top: 8px;
			font-size: 16px;
			font-weight: bold;
		}
	</style>
</head>

<body>
	<div layout:fragment="content" class="container">
		<h2 style="padding-left: 20px; padding-top: 20px;">신작 웹소설</h2>

		<!-- 필터 헤더 -->
		<div class="filter-header">
			<!-- 좌측: 인기순 / 최신순 -->
			<div class="filter-left">
				<a th:href="@{/book/new-released(order='popular', adult=${adult}, fin=${fin})}"
				   th:classappend="${order == 'popular'} ? 'active'" class="filter-btn">인기순</a>
				<a th:href="@{/book/new-released(order='latest', adult=${adult}, fin=${fin})}"
				   th:classappend="${order == 'latest'} ? 'active'" class="filter-btn">최신순</a>
			</div>

			<!-- 우측: 성인작품만 / 성인작품 제외 -->
			<form id="filterForm" method="get" action="/book/new-released" class="filter-right">
				<input type="hidden" name="order" th:value="${order}" />

				<label class="filter-btn">
					<input type="checkbox" id="adultTrue" value="true"
						   th:checked="${adult == true}" /> 성인작품만
				</label>

				<label class="filter-btn">
					<input type="checkbox" id="adultFalse" value="false"
						   th:checked="${adult == false}" /> 성인작품 제외
				</label>
			</form>
		</div>

		<!-- 도서 목록 -->
		<div class="book-grid">
			<div class="book-item" th:each="book : ${bookList}">
				<img th:src="@{'/resources/static/covers/cover' + ${book.bo_code} + '.png'}"
					 th:alt="${book.bo_title}" />
				<div class="book-title" th:text="${book.bo_title}">도서 제목</div>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener("DOMContentLoaded", () => {
			console.log("🔥 필터 스크립트 로드됨");
			const form = document.getElementById("filterForm");
			const adultTrue = document.getElementById("adultTrue");
			const adultFalse = document.getElementById("adultFalse");

			const updateAndSubmit = (event) => {
				console.log("✅ 필터 클릭됨:", event.target.id);

				// 동시에 두 개 체크 방지
				if (adultTrue.checked && adultFalse.checked) {
					if (event.target === adultTrue) {
						adultFalse.checked = false;
					} else {
						adultTrue.checked = false;
					}
				}

				// 모든 name 제거
				adultTrue.removeAttribute("name");
				adultFalse.removeAttribute("name");

				// 체크된 쪽만 name 부여
				if (adultTrue.checked) {
					adultTrue.setAttribute("name", "adult");
				} else if (adultFalse.checked) {
					adultFalse.setAttribute("name", "adult");
				}

				console.log("📤 submit adult=", 
					adultTrue.checked ? "true" : 
					adultFalse.checked ? "false" : "없음"
				);

				form.submit(); // requestSubmit 도 가능
			};

			adultTrue.addEventListener("change", updateAndSubmit);
			adultFalse.addEventListener("change", updateAndSubmit);
		});
	</script>
</body>
</html>
