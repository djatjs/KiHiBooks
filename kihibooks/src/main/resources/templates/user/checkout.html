<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout.html}">

<head>
	<meta charset="UTF-8">
	<title>주문/결제 - 키히</title>
	<style>
		ul {
			list-style-type: none;
			margin: 0;
			padding: 0;
		}

		.gray {
			filter: brightness(0) saturate(100%) invert(75%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
		}

		.books-content {
			width: 100%;
			position: relative;
			min-height: 500px;
		}

		.indent-hidden {
			position: absolute;
			display: inline-block;
			height: 0;
			width: 0;
			text-indent: -9999px;
			overflow: hidden;
		}

		.page-checkout {
			cursor: default;
			display: table;
			table-layout: fixed;
			width: 952px;
			margin: 48px auto 100px;
		}

		.order-list-wrapper {
			display: table-cell;
			width: 564px;
			vertical-align: top;
			color: #666;
			font-size: 12px;
			line-height: 1em;
		}

		.order-list {
			display: block;
			margin: 0;
			padding: 0;
		}

		.order-list-title {
			padding-bottom: 14px;
			border-bottom: 1px solid #ebe7e5;
			font-size: 18px;
			font-weight: 700;
			color: #000;
		}

		.list-count {
			font-size: 16px;
			color: #928681;
		}

		.book-order-list {
			line-height: initial;
		}

		.book-macro {
			display: table;
			width: 100%;
			border-bottom: 1px solid #dfdfdf;
		}

		.book-thumbnail-wrapper {
			padding: 15px 0 15px 8px;
			display: table-cell;
			vertical-align: top;
			width: 60px;
		}

		.book-thumbnail {
			display: inline-block;
			position: relative;
			height: auto;
		}

		.thumbnail-img {
			display: block;
			width: 100%;
			height: 100%;
			position: relative;
			background: #d9d9d9;
		}

		.thumbnail-img::before {
			content: "";
			box-sizing: border-box;
			display: block;
			width: 100%;
			height: 100%;
			position: absolute;
			left: 0;
			top: 0;
			background: linear-gradient(to right, rgba(0, 0, 0, .2) 0, rgba(0, 0, 0, 0) 5%, rgba(0, 0, 0, 0) 95%, rgba(0, 0, 0, .2) 100%);
			;
		}

		.thumbnail {
			width: 60px;
			max-height: 87px;
		}

		.border {
			box-sizing: border-box;
			opacity: .1;
			display: block;
			width: 100%;
			height: 100%;
			position: absolute;
			left: 0;
			top: 0;
			z-index: 3;
			border: 1px solid #000;
		}

		.thumbnail-btn {
			display: block;
			position: absolute;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			z-index: 9;
			cursor: pointer;
			box-sizing: border-box;
		}

		.table-cell-wrapper {
			display: table-cell;
			vertical-align: middle;
			padding: 10px 0 15px 0;
		}

		.table-wrapper {
			display: table;
			width: 100%;
		}

		.book-metadata-wrapper {
			padding: 0 8px 15px 15px;
			position: relative;
			display: table-cell;
			vertical-align: top;
			cursor: default;
		}

		.meta-title {
			display: block;
			margin-top: 3px;
			margin-bottom: 7px;
			font-size: 13px;
		}

		.title-link {
			text-decoration: none;
			color: #666;
		}

		.title-text {
			font-size: 13px;
			color: #000;
			font-weight: 700;
			line-height: 1.4em;
			text-overflow: ellipsis;
			word-wrap: break-word;
			word-break: break-all;
			white-space: normal;
			max-height: 2.7em;
			overflow: hidden;
		}

		.meta-author {
			height: auto;
			padding: 0;
			margin-left: 0;
			display: block;
			margin-top: 3px;
			position: relative;
			font-size: 12px;
			color: #666;
			font-weight: 400;
			word-break: break-all;
			line-height: 1.5em;
		}

		.author-detail-link {
			display: inline;
			margin-top: 0;
			font-size: 12px;
			color: #666;
			font-weight: 400;
			line-height: 1.2em;
			word-break: break-all;
		}

		.book-price-wrapper {
			display: table-cell;
			vertical-align: middle;
			cursor: default;
			text-align: right;
		}

		.ebook-price {
			font-size: 14px;
			white-space: nowrap;
		}

		.ebook-price strong {
			color: #ff7f50;
			font-weight: bolder;
		}

		.order-receipt-wrapper {
			width: 346px;
			display: table-cell;
			vertical-align: top;
			padding-left: 50px;
		}

		.order-info-article {
			display: block;
			margin: 0;
			padding: 0;
		}

		.order-info-article-title {
			color: #141414;
			padding-bottom: 15px;
			font-size: 18px;
			font-weight: 700;
		}

		.order-info-wrapper {
			border: 1px solid #ccc;
		}

		.info-list {
			border-top: none;
			min-height: 44px;
			position: relative;
		}

		.section-title {
			position: absolute;
			left: 14px;
			top: 15px;
		}

		.title {
			font-size: 14px;
			font-weight: 700;
			color: #141414;
		}

		.none-asset {
			padding: 15px 14px;
			text-align: right;
			font-size: 13px;
			font-weight: 700;
			color: #baaeab;
		}

		.total-order-price-wrapper {
			text-align: right;
			padding: 12px 15px;
		}

		.total-regular-price {
			font-size: 13px;
			font-weight: 700;
			line-height: normal;
			color: #141414;
		}

		.point-wrapper {
			border: 1px solid #e6e6e6;
			border-bottom: none;
		}

		.what-is-kihi-point {
			display: block;
			position: absolute;
			right: -22px;
			top: -3px;
			width: 17px;
			height: 20px;
			box-sizing: border-box;
			border: 1px solid #d6d1ce;
			border-radius: 3px;
			background: #fff;
			text-align: center;
			line-height: 18px;
			font-size: 12px;
			font-weight: 700;
			color: #928581;
		}

		.asset-wrapper {
			text-align: right;
			padding: 10px 14px 13px 14px;
		}

		.asset-input-wrapper {
			display: inline-block;
		}

		.asset-input-out-liner {
			display: flex;
			width: 143px;
			height: 34px;
			box-sizing: border-box;
			border-radius: 3px;
			border: 1px solid #d6cfce;
			justify-content: end;
			padding-left: 18px;
			align-items: center;
		}

		.asset-input {
			vertical-align: inherit;
			text-align: right;
			width: 100px;
			flex: 1;
			border: 0;
			background: 0 0;
			box-shadow: none;
			font-size: 15px;
			font-weight: 700;
			color: #000;
			height: 32px;
			line-height: 32px;
		}

		.currency {
			display: inline-block;
			padding-right: 10px;
			font-size: 15px;
			font-weight: 700;
			color: #000;
			height: 32px;
			line-height: 32px;
		}

		.asset-input-out-liner input:focus {
			border: none;
			outline: none;
		}

		.asset-description-wrapper {
			display: flex;
			align-items: baseline;
			justify-content: flex-end;
			margin-top: 6px;
		}

		.asset-description {
			display: inline-block;
			margin-right: 4px;
			font-size: 13px;
			line-height: 1.4em;
			color: #787878 !important;
		}

		.asset-use-all-btn {
			border-color: #ccc;
			color: #787878;
			box-shadow: none;
			width: 75px;
			height: 30px;
			font-size: 12px;
			padding: 0;
			margin: 0;
			appearance: none;
			outline: 0;
			text-decoration: none;
			box-sizing: border-box;
			border-radius: 4px;
			font-weight: 700;
			display: inline-block;
			text-align: center;
			cursor: pointer;
			line-height: 1em;
			vertical-align: baseline;
			transition: background .2s, color .2s;
			border: 1px solid #d9d4d1;
			background: #fff;
		}

		.current-price-wrapper {
			background: rgba(255, 241, 235, 0.5);
			margin: 0;
			padding: 0;
			padding: 22px 0 20px 0;
			text-align: center;
		}

		.current-price {
			display: flex;
			justify-content: center;
			align-items: center;
			color: #141414 !important;
			font-size: 14px;
		}

		.total-payment-price-text {
			margin-right: 5px;
		}

		.price-num,
		.won-text {
			font-size: 20px;
			color: #ff7f50 !important;
		}

		.kihipay-wrapper {
			font-size: 14px;
			overflow-wrap: break-word;
			word-wrap: break-word;
			line-height: normal;
			margin: 0;
			padding: 0;
			color: #000;
			font-weight: 400;
		}

		.kihipay-wrap {
			display: flex;
			flex-direction: column;
		}

		.kihipay-banner {
			align-items: center;
			width: 100%;
			border-radius: 4px;
			overflow: hidden;
			display: block;
			margin-top: 25px;
		}

		.kihipay-banner>a {
			display: flex;
		}

		.kihipay-banner {
			width: 100%;
		}

		.kihipay-method-section {
			margin-top: 25px;
		}

		.kihipay-method-title {
			color: #141414;
			font-size: 18px;
			font-weight: 700;
			line-height: normal;
			padding: 4px 0;
			margin: 0;
		}

		.kihipay-method-ul {
			margin-top: 8px;
		}

		.kihipay-method-li {
			display: flex;
			width: 100%;
			flex-direction: column;
			align-items: center;
			background: rgb(255, 255, 255);
			border: 2px solid #ff7f50;
		}

		.kihipay-charge-payment {
			display: flex;
			align-items: center;
			justify-content: space-between;
			width: 100%;
			height: 57px;
			padding: 0px 13px;
		}

		.kihipay-payment-wrapper {
			flex-direction: column;
			display: flex;
			width: 100%;
		}

		.kihipay-charge-or-pay {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: space-between;
			width: 100%;
			border-top: 1px solid rgb(230, 230, 230);
		}

		.kihipay-charge-label,
		.kihipay-just-pay-label {
			cursor: pointer;
			width: 100%;
			display: flex;
			align-items: center;
			padding: 0px 13px;
			margin: 0;
		}

		.kihipay-charge-checkbox,
		.kihipay-pay-checkbox,
		.kihipay-pay-method-checkbox {
			width: 0px;
			height: 0px;
			border: 0px;
		}

		.kihipay-charge-check-img,
		.kihipay-pay-check-img {
			display: flex;
			align-self: center;
			cursor: pointer;
			width: 22px;
		}

		.kihipay-charge-text,
		.kihipay-pay-text {
			display: flex;
			align-items: center;
			height: 64px;
			padding: 0px 10px;
		}

		.kihipay-pay-method-title {
			color: rgb(20, 20, 20);
			font-size: 14px;
			font-weight: 600;
			line-height: normal;
			margin: 10px 15px 0px 15px;
			border-bottom: 1px solid rgb(230, 230, 230);
		}

		.kihipay-charge-title,
		.kihipay-direct-pay-title {
			color: rgb(20, 20, 20);
			font-size: 14px;
			font-weight: 600;
			line-height: normal;
			margin-top: 6px;
		}

		.kihipay-charge-bonus {
			font-size: 13px;
			font-weight: 600;
			line-height: normal;
			margin-left: 5px;
			color: rgb(142, 88, 255);
		}

		.kihipay-charge-wrapper {
			flex-direction: column;
			display: flex;
			width: 100%;
		}

		.kihipay-charge-select-wrapper {
			position: relative;
			width: 100%;
			padding-bottom: 16px;
		}

		.kihipay-charge-select {
			position: relative;
			display: flex;
			justify-content: center;
		}

		.kihipay-charge-select-text {
			display: flex;
			align-items: center;
			justify-content: space-between;
			width: 100%;
			max-width: 260px;
			height: 42px;
			margin: 0px auto;
			border-radius: 3px;
			border: 1px solid rgb(204, 204, 204);
			padding: 0px 10px;
		}

		.kihipay-charge-sel-text {
			display: flex;
			color: rgb(120, 120, 120);
			font-size: 14px;
			font-weight: 500;
			line-height: normal;
			margin-right: auto;
		}

		.kihipay-charge-selected {
			display: flex;
			overflow: hidden;
			flex-basis: 181px;
			justify-content: flex-end;
			margin-top: 17px;
			margin-right: 4px;
		}

		.kihipay-charge-selected>p {
			color: rgb(20, 20, 20);
			font-size: 14px;
			font-weight: 600;
			overflow: hidden;
			text-overflow: ellipsis;
			overflow-wrap: break-word;
			word-break: keep-all;
			max-height: calc(16px);
			line-height: 16px;
			display: block;
			white-space: nowrap;
			text-align: right;
		}

		.kihipay-charge-sel {
			position: absolute;
			top: 0px;
			left: 0px;
			right: 0px;
			margin: 0px auto;
			width: 100%;
			max-width: 260px;
			height: 42px;
			padding: 0px;
			border: 1px solid rgb(204, 204, 204);
			opacity: 0;
			user-select: none;
		}

		.kihipay-charge-select-wrapper::after {
			content: "";
			position: absolute;
			left: 0px;
			right: 0px;
			bottom: 0px;
			margin: 0px auto;
			max-width: 260px;
			height: 1px;
			background: rgb(230, 230, 230);
		}

		.kihipay-pay-wrapper {
			width: 100%;
		}

		.kihipay-pay-ul {
			display: flex;
			flex-direction: column;
			width: 100%;
			list-style: none;
			padding: 15px 0px 7px;
		}

		.kihipay-pay-ul>li {
			margin-bottom: 10px;
		}

		.kihipay-pay-label {
			width: 100%;
			display: flex;
			align-items: center;
			padding: 0px 12px;
		}

		.kihipay-pay-title {
			display: flex;
			padding-left: 10px;
			color: rgb(20, 20, 20);
			font-size: 13px;
			font-weight: 500;
			line-height: normal;
		}

		.pay-ul-wrapper {
			margin: 20px;
			border: 1px solid rgb(230, 230, 230);
		}

		.kihipay-detail-section {
			margin-top: 25px;
		}

		.kihipay-detail-title {
			color: #141414;
			font-size: 18px;
			font-weight: 700;
			line-height: normal;
			padding: 4px 0;
		}

		.kihipay-detail-wrapper {
			display: flex;
			flex-direction: column;
			margin-top: 8px;
			border: 1px solid rgb(204, 204, 204);
		}

		.kihipay-detail-order {
			display: flex;
			align-items: center;
			flex-direction: column;
			padding: 13px 14px;
		}

		.kihipay-detail-text {
			display: flex;
			justify-content: space-between;
			width: 100%;
			color: rgb(20, 20, 20);
			font-size: 14px;
			line-height: normal;
		}

		.kihipay-detail-text>span:first-of-type {
			font-weight: 600;
		}

		.kihipay-detail-text>span:last-of-type {
			font-weight: 700;
		}

		.kihipay-detail-use {
			display: flex;
			flex-direction: column;
			padding: 14px 14px 13px;
			border-top: 1px solid rgb(230, 230, 230);
		}

		.kihipay-detail-left {
			position: relative;
			display: flex;
			flex-direction: column;
			margin-top: 8px;
		}

		.kihipay-detail-left::before {
			content: "";
			position: absolute;
			width: 2px;
			height: calc(100% - 4px);
			top: 2px;
			left: 3px;
			background: rgb(204, 204, 204);
		}

		.kihipay-detail-left>li {
			display: flex;
			justify-content: space-between;
			padding-left: 12px;
			color: rgb(120, 120, 120);
			font-size: 13px;
			font-weight: 400;
			line-height: normal;
		}

		.kihipay-checkout-section {
			margin-top: 25px;
		}

		.kihipay-checkbox-wrapper {
			display: flex;
			width: 100%;
			flex-direction: column;
		}

		.kihipay-checkbox-label {
			width: 100%;
			align-items: center;
			box-sizing: border-box;
		}

		label {
			display: flex;
		}

		.kihipay-checkbox {
			width: 0px;
			height: 0px;
			border: 0px;
		}

		.kihipay-checkbox-description {
			display: flex;
			justify-content: space-between;
			width: 100%;
		}

		.kihipay-checkbox-text {
			padding: 0;
			margin: 0;
			color: rgb(20, 20, 20);
			font-size: 14px;
			font-weight: 500;
			line-height: 20px;
			padding-left: 10px;
			cursor: pointer;
		}

		.kihipay-checkbox-img {
			cursor: pointer;
		}

		.kihipay-checkout-submit {
			display: flex;
			justify-content: center;
			align-items: center;
			margin-top: 20px;
			width: 100%;
			height: 46px;
			border-radius: 6px;
			background-color: #ff7f50;
			font-size: 15px;
			font-weight: 600;
			color: #fff;
			line-height: normal;
			appearance: none;
			border: 0;
		}

		.kihipay-checkout-title {
			color: rgb(120, 120, 120);
			font-size: 14px;
			font-weight: 700;
			line-height: normal;
			margin-top: 20px;
		}

		.kihipay-checkout-note-ul {
			position: relative;
			padding-right: 11px;
			margin-top: 7px;
		}

		.kihipay-checkout-note-ul>li {
			position: relative;
			color: rgb(120, 120, 120);
			font-size: 13px;
			font-weight: 400;
			line-height: 20px;
			margin-left: 12px;
		}

		.kihipay-checkout-note-ul>li::before {
			content: " ";
			position: absolute;
			top: 8px;
			left: -12px;
			width: 4px;
			height: 4px;
			background-color: rgb(204, 204, 204);
			border-radius: 50%;
		}
	</style>
</head>

<body>
	<main layout:fragment="content" class="container d-flex" style="min-height: 650px;">
		<div class="books-content">
			<div>
				<h2 class="indent-hidden">주문/결제</h2>
				<section class="page-checkout">
					<div class="order-list-wrapper">
						<article class="order-list">
							<h3 class="order-list-title">주문 목록
								<span class="list-count" th:text="${epList.size()}"></span>
							</h3>
							<ul class="book-order-list-wrapper">
								<li class="book-order-list" th:each="episode : ${epList}" th:attr="data-ep-code=${episode.ep_code}">
									<div class="book-macro">
										<div class="book-thumbnail-wrapper" th:attr="data-bo-code=${episode.ep_bo_code}">
											<div class="book-thumbnail">
												<div class="thumbnail-img">
													<img class="thumbnail" src="/resources/static/covers/cover1.png" alt="썸네일 이미지"
														th:attr="data-src=${episode.ep_cover_img}">
													<span class="border"></span>
												</div>
												<a class="thumbnail-btn" th:href="@{'/books/' + ${episode.ep_bo_code}}">
													<span class="indent-hidden">상세페이지 바로가기</span>
												</a>
											</div>
										</div>
										<div class="table-cell-wrapper">
											<div class="table-wrapper">
												<div class="book-metadata-wrapper">
													<div class="meta-title">
														<a class="title-link" th:href="@{'/books/' + ${episode.ep_bo_code}}">
															<span class="title-text" th:text="${episode.ep_title}"></span>
														</a>
													</div>
													<p class="meta-author">
														<a th:href="@{/}" class="author-detail-link" th:text="${episode.ep_author}"></a>
													</p>
												</div>
												<div class="book-price-wrapper">
													<ul class="book-price">
														<li class="ebook-price">
															<strong>
																<span th:text="${episode.ep_price} + '원'"></span>
															</strong>
														</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
								</li>
							</ul>
						</article>
					</div>
					<div class="order-receipt-wrapper">
						<form id="order_form" method="post" th:action="@{/payment/request}">
							<article class="order-info-article">
								<div class="order-info-article-inner-wrapper">
									<h3 class="order-info-article-title">포인트</h3>
									<div class="order-info-wrapper">
										<ul>
											<li class="info-list">
												<div class="section-title">
													<h4 class="title">총 주문 금액</h4>
												</div>
												<div class="total-order-price-wrapper">
													<p class="total-regular-price">
														<span th:text="${formattedTotal} + '원'"></span>
													</p>
												</div>
											</li>
											<li class="info-list point-wrapper">
												<div class="section-title">
													<h4 class="title">키히포인트</h4>
													<a href="/" class="what-is-kihi-point">?</a>
												</div>
												<div class="asset-wrapper" th:if="${point != 0}">
													<div class="asset-input-wrapper">
														<div class="asset-input-out-liner">
															<label for="use_point" class="indent-hidden">사용할
																키히포인트</label>
															<input type="text" class="asset-input" id="use_point" name="use_point"
																title="사용할 키히포인트 금액 입력">
															<span class="currency">원</span>
														</div>
													</div>
													<div class="asset-description-wrapper">
														<p class="asset-description">내 키히포인트 :
															<strong>
																<span th:attr="data-amount=${point}" th:text="${formattedPoint} + '원'"></span>
															</strong>
														</p>
														<button type="button" class="asset-use-all-btn">전액 사용</button>
													</div>
												</div>
												<p class="none-asset" th:if="${point == 0}">0원</p>
											</li>
											<li>
												<p class="current-price-wrapper">
													<strong class="current-price">
														<span class="total-payment-price-text">부족한 금액</span>
														<span class="price-num">0</span>
														<span class="won-text">원</span>
													</strong>
												</p>
											</li>
										</ul>
									</div>
									<div id="kihipay">
										<div class="kihipay-wrapper">
											<div class="kihipay-wrap">
												<section class="kihipay-method-section">
													<h2 class="kihipay-method-title">결제 수단</h2>
													<ul class="kihipay-method-ul">
														<li class="kihipay-method-li">
															<div class="kihipay-charge-payment">
																<h4>
																	<img src="/resources/static/check/kihipay.png" alt="키히페이" style="width: 76px;"
																		class="mt-1">
																</h4>
															</div>
															<div class="kihipay-payment-wrapper">
																<div class="kihipay-charge-or-pay">
																	<label class="kihipay-charge-label">
																		<input type="checkbox" class="kihipay-charge-checkbox" readonly checked>
																		<span class="kihipay-charge-check-img">
																			<img src="/resources/static/check/radio.png" alt="체크박스" style="width: 24px;">
																		</span>
																		<span class="kihipay-charge-text">
																			<h5 class="kihipay-charge-title">충전 후 결제
																			</h5>
																			<span class="kihipay-charge-bonus">최대 적립
																				5%</span>
																		</span>
																	</label>
																</div>
																<div class="kihipay-charge">
																	<div class="kihipay-charge-wrapper">
																		<div class="kihipay-charge-select-wrapper">
																			<div class="kihipay-charge-select">
																				<div class="kihipay-charge-select-text">
																					<span class="kihipay-charge-sel-text">충전</span>
																					<span class="kihipay-charge-selected">
																						<p>2,000원 (포인트 3% 적립)</p>
																					</span>
																					<img src="/resources/static/img/down-triangle.png" alt="아래 삼각형"
																						style="width: 10px; height: 11px;" class="gray">
																				</div>
																				<select class="kihipay-charge-sel">
																					<option value="2000">2,000원 (포인트 3%
																						적립)</option>
																					<option value="5000">5,000원 (포인트 3%
																						적립)</option>
																					<option value="10000">10,000원 (포인트
																						3% 적립)</option>
																					<option value="20000">20,000원 (포인트
																						3% 적립)</option>
																					<option value="30000">30,000원 (포인트
																						4% 적립)</option>
																					<option value="50000">50,000원 (포인트
																						4% 적립)</option>
																					<option value="100000">100,000원 (포인트
																						5% 적립)</option>
																					<option value="200000">200,000원 (포인트
																						5% 적립)</option>
																					<option value="300000">300,000원 (포인트
																						5% 적립)</option>
																					<option value="500000">500,000원 (포인트
																						5% 적립)</option>
																					<option value="1000000">1,000,000원
																						(포인트 5% 적립)</option>
																					<option value="2000000">2,000,000원
																						(포인트 5% 적립)</option>
																				</select>
																			</div>
																		</div>
																	</div>
																	<script>
																		const select = document.querySelector('.kihipay-charge-sel');
																		const selectedText = document.querySelector('.kihipay-charge-selected p');

																		select.addEventListener('change', function () {
																			const selectedOption = select.options[select.selectedIndex];
																			selectedText.textContent = selectedOption.text;
																		});
																	</script>
																	<div class="kihipay-pay-wrapper">
																		<div class="pay-ul-wrapper">
																			<h5 class="kihipay-pay-method-title">결제 방법
																			</h5>
																			<ul class="kihipay-pay-ul">
																				<li>
																					<label class="kihipay-pay-label" data-method-type="naver">
																						<input type="checkbox" class="kihipay-pay-method-checkbox" readonly checked>
																						<span class="kihipay-pay-method-check-img">
																							<img src="/resources/static/check/radio.png" alt="체크박스"
																								style="width: 24px;">
																						</span>
																						<span class="kihipay-pay-title">
																							<span class="kihipay-pay-logo">
																								<img src="/resources/static/logo/naver_pay.svg" alt="네이버 페이"
																									style="width: 53px;">
																							</span>
																						</span>
																					</label>
																				</li>
																				<li>
																					<label class="kihipay-pay-label" data-method-type="kakao">
																						<input type="checkbox" class="kihipay-pay-method-checkbox" readonly>
																						<span class="kihipay-pay-method-check-img">
																							<img src="/resources/static/check/circle.png" alt="체크박스"
																								style="width: 24px;">
																						</span>
																						<span class="kihipay-pay-title">
																							<span class="kihipay-pay-logo">
																								<img src="/resources/static/logo/kakao_pay.png" alt="카카오 페이"
																									style="width: 51px;">
																							</span>
																						</span>
																					</label>
																				</li>
																				<li>
																					<label class="kihipay-pay-label" data-method-type="toss">
																						<input type="checkbox" class="kihipay-pay-method-checkbox" readonly>
																						<span class="kihipay-pay-method-check-img">
																							<img src="/resources/static/check/circle.png" alt="체크박스"
																								style="width: 24px;">
																						</span>
																						<span class="kihipay-pay-title">
																							<span class="kihipay-pay-logo">
																								<img src="/resources/static/logo/toss_pay.png" alt="토스 페이"
																									style="width: 83px;">
																							</span>
																						</span>
																					</label>
																				</li>
																			</ul>
																		</div>
																	</div>
																</div>
																<div class="kihipay-charge-or-pay">
																	<label class="kihipay-just-pay-label">
																		<input type="checkbox" class="kihipay-pay-checkbox" readonly>
																		<span class="kihipay-pay-check-img">
																			<img src="/resources/static/check/circle.png" alt="체크박스" style="width: 24px;">
																		</span>
																		<span class="kihipay-pay-text">
																			<h5 class="kihipay-direct-pay-title">일반 결제
																			</h5>
																		</span>
																	</label>
																</div>
																<div class="kihipay-pay">
																	<div class="kihipay-pay-wrapper" style="margin-top: -20px;">
																		<div class="pay-ul-wrapper">
																			<h5 class="kihipay-pay-method-title">결제 방법
																			</h5>
																			<ul class="kihipay-pay-ul">
																				<li>
																					<label class="kihipay-pay-label" data-method-type="naver">
																						<input type="checkbox" class="kihipay-pay-method-checkbox" readonly checked>
																						<span class="kihipay-pay-method-check-img">
																							<img src="/resources/static/check/radio.png" alt="체크박스"
																								style="width: 24px;">
																						</span>
																						<span class="kihipay-pay-title">
																							<span class="kihipay-pay-logo">
																								<img src="/resources/static/logo/naver_pay.svg" alt="네이버 페이"
																									style="width: 53px;">
																							</span>
																						</span>
																					</label>
																				</li>
																				<li>
																					<label class="kihipay-pay-label" data-method-type="kakao">
																						<input type="checkbox" class="kihipay-pay-method-checkbox" readonly>
																						<span class="kihipay-pay-method-check-img">
																							<img src="/resources/static/check/circle.png" alt="체크박스"
																								style="width: 24px;">
																						</span>
																						<span class="kihipay-pay-title">
																							<span class="kihipay-pay-logo">
																								<img src="/resources/static/logo/kakao_pay.png" alt="카카오 페이"
																									style="width: 51px;">
																							</span>
																						</span>
																					</label>
																				</li>
																				<li>
																					<label class="kihipay-pay-label" data-method-type="toss">
																						<input type="checkbox" class="kihipay-pay-method-checkbox" readonly>
																						<span class="kihipay-pay-method-check-img">
																							<img src="/resources/static/check/circle.png" alt="체크박스"
																								style="width: 24px;">
																						</span>
																						<span class="kihipay-pay-title">
																							<span class="kihipay-pay-logo">
																								<img src="/resources/static/logo/toss_pay.png" alt="토스 페이"
																									style="width: 83px;">
																							</span>
																						</span>
																					</label>
																				</li>
																			</ul>
																		</div>
																	</div>
																</div>
															</div>
														</li>
													</ul>
												</section>
												<section class="kihipay-detail-section">
													<h2 class="kihipay-detail-title">결제 상세</h2>
													<div class="kihipay-detail-wrapper">
														<div class="kihipay-detail-order">
															<h3 class="kihipay-detail-text">
																<span>주문 금액</span>
																<span th:text="${formattedTotal} + '원'"></span>
															</h3>
														</div>
														<div class="kihipay-detail-use">
															<h4 class="kihipay-detail-text">
																<span>포인트 사용</span>
																<span></span>
															</h4>
															<ul class="kihipay-detail-left">
																<li>
																	<span>결제 후 잔여 포인트</span>
																	<span th:text="${formattedPoint} + '원'"></span>
																</li>
															</ul>
														</div>
													</div>
													<div class="kihipay-charge-detail-wrapper">
														<div class="kihipay-detail-order">
															<h3 class="kihipay-detail-text">
																<span>키히포인트 충전</span>
																<span>2,000원</span>
															</h3>

														</div>
													</div>
												</section>
												<section class="kihipay-checkout-section">
													<div class="kihipay-checkbox-wrapper">
														<label class="kihipay-checkout-label">
															<input type="checkbox" class="kihipay-checkbox" readonly>
															<span class="kihipay-checkbox-img">
																<img src="/resources/static/check/circle.png" alt="체크박스" style="height: 22px;">
															</span>
															<span class="kihipay-checkbox-description">
																<p class="kihipay-checkbox-text">상품, 가격, 유의 사항 등을 확인하였으며
																	구매에 동의합니다. (필수)</p>
															</span>
														</label>
													</div>
													<button type="submit" class="kihipay-checkout-submit">결제</button>
													<h4 class="kihipay-checkout-title">결제 유의사항</h4>
													<ul class="kihipay-checkout-note-ul">
														<li>키히포인트는 먼저 충전한 순서대로 사용됩니다.</li>
														<li>문화비 소득공제는 주문 도서와 결제 수단에 따라 적용됩니다.</li>
														<li>미성년자의 경우 결제 시 법정대리인의 동의가 필요하며, 이에 따라 법정대리인의 동의를 받았음을 확인합니다.
														</li>
													</ul>
												</section>
											</div>
										</div>
									</div>
								</div>
							</article>
						</form>
					</div>
				</section>
			</div>
		</div>
		<script>
			document.addEventListener("DOMContentLoaded", () => {
				const pointInput = document.getElementById("use_point");
				const useAllBtn = document.querySelector(".asset-use-all-btn");
				const totalAmount = parseInt(document.querySelector(".total-regular-price span").innerText.replace(/[^0-9]/g, ""));
				const pointEl = document.querySelector("span[data-amount]");
				const userPoint = parseInt(pointEl.getAttribute("data-amount"));
				const lackPriceEl = document.querySelector(".price-num");

				const updatePointUsage = (usedPoint) => {
					pointInput.value = usedPoint.toLocaleString();
					const lack = totalAmount - usedPoint;
					lackPriceEl.textContent = lack > 0 ? lack.toLocaleString() : "0";
				};

				// 초기 설정
				if (userPoint >= totalAmount) {
					updatePointUsage(totalAmount);
				} else {
					updatePointUsage(userPoint);
				}

				// 전액 사용 버튼 클릭 시
				useAllBtn.addEventListener("click", () => {
					if (userPoint >= totalAmount) {
						updatePointUsage(totalAmount);
					} else {
						updatePointUsage(userPoint);
					}
				});
			});

			document.addEventListener("DOMContentLoaded", function () {
				// 결제 방식 영역
				const chargeLabel = document.querySelector(".kihipay-charge-label");
				const justPayLabel = document.querySelector(".kihipay-just-pay-label");
				const chargeCheckbox = chargeLabel?.querySelector("input[type='checkbox']");
				const justPayCheckbox = justPayLabel?.querySelector("input[type='checkbox']");
				const chargeImg = chargeLabel?.querySelector("img");
				const justPayImg = justPayLabel?.querySelector("img");

				// 하위 결제 수단 영역
				const chargeSection = document.querySelector(".kihipay-charge");
				const paySection = document.querySelector(".kihipay-pay");

				// 결제 수단 라벨들 (네이버, 카카오, 토스)
				const allPayLabels = document.querySelectorAll(".kihipay-pay-label[data-method-type]");

				// [1] 하위 결제 수단 중 첫 번째(네이버 페이)를 자동 선택
				function selectFirstMethod(containerSelector) {
					const container = document.querySelector(containerSelector);
					if (!container) return;

					const labels = container.querySelectorAll(".kihipay-pay-label[data-method-type]");
					labels.forEach(function (label, index) {
						const checkbox = label.querySelector("input");
						const img = label.querySelector("img");

						if (index === 0) {
							checkbox.checked = true;
							img.src = "/resources/static/check/radio.png";
						} else {
							checkbox.checked = false;
							img.src = "/resources/static/check/circle.png";
						}
					});
				}

				// [2] 결제 방식 선택 시
				chargeLabel?.addEventListener("click", function () {
					chargeCheckbox.checked = true;
					chargeImg.src = "/resources/static/check/radio.png";

					justPayCheckbox.checked = false;
					justPayImg.src = "/resources/static/check/circle.png";

					chargeSection.style.display = "block";
					paySection.style.display = "none";

					selectFirstMethod(".kihipay-charge");
				});

				justPayLabel?.addEventListener("click", function () {
					justPayCheckbox.checked = true;
					justPayImg.src = "/resources/static/check/radio.png";

					chargeCheckbox.checked = false;
					chargeImg.src = "/resources/static/check/circle.png";

					chargeSection.style.display = "none";
					paySection.style.display = "block";

					selectFirstMethod(".kihipay-pay");
				});

				// [3] 결제 수단 선택 시 (충전 후 결제 + 일반 결제 모두 포함)
				allPayLabels.forEach(function (label) {
					label.addEventListener("click", function () {
						const currentGroup = label.closest(".kihipay-charge") || label.closest(".kihipay-pay");
						if (!currentGroup) return;

						const groupLabels = currentGroup.querySelectorAll(".kihipay-pay-label[data-method-type]");
						groupLabels.forEach(function (lbl) {
							lbl.querySelector("input").checked = false;
							lbl.querySelector("img").src = "/resources/static/check/circle.png";
						});

						label.querySelector("input").checked = true;
						label.querySelector("img").src = "/resources/static/check/radio.png";
					});
				});

				// [4] 초기 UI 상태 반영
				function updateInitialState() {
					if (chargeCheckbox?.checked) {
						chargeImg.src = "/resources/static/check/radio.png";
						justPayImg.src = "/resources/static/check/circle.png";
						chargeSection.style.display = "block";
						paySection.style.display = "none";
						selectFirstMethod(".kihipay-charge");
					} else if (justPayCheckbox?.checked) {
						justPayImg.src = "/resources/static/check/radio.png";
						chargeImg.src = "/resources/static/check/circle.png";
						chargeSection.style.display = "none";
						paySection.style.display = "block";
						selectFirstMethod(".kihipay-pay");
					} else {
						chargeSection.style.display = "none";
						paySection.style.display = "none";
					}

					// 결제 수단 UI 체크 이미지 초기화
					allPayLabels.forEach(function (label) {
						const checkbox = label.querySelector("input");
						const img = label.querySelector("img");
						img.src = checkbox.checked ? "/resources/static/check/radio.png" : "/resources/static/check/circle.png";
					});
				}

				updateInitialState(); // 페이지 로드시 초기 상태 적용
			});

			document.addEventListener('DOMContentLoaded', function () {
				const label = document.querySelector('.kihipay-checkout-label');
				const checkbox = label.querySelector('.kihipay-checkbox');
				const img = label.querySelector('.kihipay-checkbox-img img');

				// checkbox 자체 클릭은 무효화
				checkbox.addEventListener('click', e => e.preventDefault());

				// label 클릭 시 상태 토글
				label.addEventListener('click', function () {
					const isChecked = checkbox.checked;

					checkbox.checked = !isChecked;
					img.src = checkbox.checked
						? '/resources/static/check/radio.png'
						: '/resources/static/check/circle.png';
				});
			});


			document.addEventListener('DOMContentLoaded', function () {
				const form = document.getElementById('order_form');
				const submitBtn = document.querySelector('.kihipay-checkout-submit');
				const agreementCheckbox = document.querySelector('.kihipay-checkbox');
				const usePointInput = document.getElementById('use_point');
				const totalOrderSpan = document.querySelector('.total-regular-price span');
				const chargeOptionSelect = document.querySelector('.kihipay-charge-sel');
				const chargeAfterCheckbox = document.querySelector('.kihipay-charge-checkbox');
				const justPayCheckbox = document.querySelector('.kihipay-pay-checkbox');
				const chargeWrapper = document.querySelector('.kihipay-charge-wrapper');

				// ✅ 결제 수단 확인 함수
				function getSelectedPayMethod(containerSelector) {
					const methodCheckboxes = document.querySelectorAll(`${containerSelector} .kihipay-pay-method-checkbox`);
					for (let checkbox of methodCheckboxes) {
						if (checkbox.checked) {
							const label = checkbox.closest('.kihipay-pay-label');
							return label?.dataset?.methodType || 'unknown';
						}
					}
					return 'none';
				}

				// ✅ 충전 영역 on/off 제어
				function toggleChargeArea() {
					const isChargeAfter = chargeAfterCheckbox.checked;
					if (isChargeAfter) {
						chargeWrapper.style.display = 'block';
						chargeOptionSelect.disabled = false;
					} else {
						chargeWrapper.style.display = 'none';
						chargeOptionSelect.disabled = true;
						chargeOptionSelect.value = ''; // 값 초기화 (안전하게 처리)
					}
				}

				// ✅ 최초 로드 시 상태 반영
				toggleChargeArea();

				// ✅ 라디오 버튼 변경 시 반영
				chargeAfterCheckbox?.addEventListener('change', toggleChargeArea);
				justPayCheckbox?.addEventListener('change', toggleChargeArea);

				// ✅ 제출 시 유효성 및 데이터 정리
				submitBtn.addEventListener('click', function (e) {
					// 1. 구매 동의 체크 확인
					if (!agreementCheckbox.checked) {
						e.preventDefault();
						alert('구매 동의를 체크해 주세요.');
						return;
					}

					// 2. 사용 포인트 값
					const usePoint = parseInt(usePointInput?.value?.replace(/[^0-9]/g, '') || '0', 10);

					// 3. 총 주문 금액
					const totalText = totalOrderSpan?.textContent?.replace(/[^\d]/g, '');
					const totalAmount = parseInt(totalText || '0', 10);

					// 4. 최종 결제 금액
					const finalAmount = Math.max(totalAmount - usePoint, 0);

					// 5. 결제 방식
					const isChargeAfter = chargeAfterCheckbox.checked;
					const isJustPay = justPayCheckbox.checked;

					// 6. 결제 수단
					const methodContainerSelector = isChargeAfter ? '.kihipay-charge' : '.kihipay-pay';
					const selectedMethod = getSelectedPayMethod(methodContainerSelector);

					// 7. 콘솔 확인
					console.log('--- 결제 요청 정보 ---');
					console.log('총 주문 금액:', totalAmount);
					console.log('사용 포인트:', usePoint);
					console.log('최종 결제 금액:', finalAmount);
					console.log('결제 방식:', isChargeAfter ? '충전 후 결제' : '일반 결제');
					console.log('결제 수단:', selectedMethod);
					console.log('충전 금액:', isChargeAfter ? chargeOptionSelect.value : '사용 안 함');

					// 8. 서버로 전송할 데이터 구성
					const payload = {
						totalAmount,
						usePoint,
						finalAmount,
						paymentType: isChargeAfter ? 'charge' : 'just',
						method: selectedMethod,
						chargeAmount: isChargeAfter ? chargeOptionSelect.value : 0,
					};

					// 9. AJAX 전송
					$.ajax({
						url: '/payment/process',
						method: 'POST',
						contentType: 'application/json; charset=utf-8',
						data: JSON.stringify(payload),
						dataType: 'json',
						success: function (response) {
							if (response.success) {
								// 5. 결제 수단 분기 처리
								switch (selectedMethod) {
									case 'naver':
										window.location.href = '/payment/naver/start?orderId=' + response.orderId;
										break;
									case 'kakao':
										window.location.href = '/payment/kakao/start?orderId=' + response.orderId;
										break;
									case 'toss':
										window.location.href = '/payment/toss/start?orderId=' + response.orderId;
										break;
									default:
										alert('알 수 없는 결제 수단입니다.');
										break;
								}
							} else {
								alert(response.message || '결제 요청에 실패했습니다.');
							}
						},
						error: function (xhr, status, error) {
							console.error('결제 실패:', error);
							alert('서버 오류가 발생했습니다.');
						}
					});
				});
			});



		</script>

	</main>
</body>

</html>