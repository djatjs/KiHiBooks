<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>EPUB 읽기 - [[${epCode}]]</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ✨ 1. Epub.js 라이브러리 불러오기 ✨ -->
    <!-- 이 스크립트 태그가 브라우저에게 "Epub.js 라이브러리를 사용할 준비를 해줘!" 라고 알려주는 거야 -->
    <!-- 선이 static/js 폴더에 epub.min.js 파일을 넣었다면 이 경로를 사용해! -->
    <script src="/js/epub.min.js"></script>
    <!-- CDN 사용한다면 이 경로를 사용 (위에 static 경로는 주석처리) -->
    <!-- <script src="https://unpkg.com/epubjs/dist/epub.min.js"></script> -->

    <style>
        /* EPUB 뷰어가 표시될 영역 스타일 */
        /* 스크롤 모드를 위한 스타일링 */
        #epub-area {
            width: 100%;
            height: 80vh; /* 예시: 화면 높이의 80% */
            margin: 0 auto;
            border: 1px solid #ccc;
            overflow-y: scroll; /* 세로 스크롤 가능하게 설정 */
            position: relative; /* Epub.js 내부적으로 필요할 수 있음 */
        }
         /* Epub.js가 생성하는 요소들의 스타일 */
        .epub-container { /* Epub.js가 만드는 내부 컨테이너 클래스 */
            height: 100% !important; /* 스크롤 모드에서 중요 */
        }
        .epub-view { /* Epub.js가 각 챕터를 렌더링하는 뷰 클래스 */
            /* 필요한 스타일 추가 */
        }
    </style>
</head>
<body>
    <h1>EPUB 읽기 - <span th:text="${epCode}"></span></h1>
    <input type="hidden" th:value="${epCode}" id="epCode">
    <!-- 나중에 책 제목 같은 정보도 Model로 받아서 여기에 표시하면 좋겠지? -->

    <!-- ✨ 2. EPUB 내용이 표시될 HTML 구조 (div) ✨ -->
    <!-- Epub.js가 이 div 안에 EPUB 내용을 그려줄 거야! -->
    <div id="epub-area"></div>

    <!-- ✨ 3. EPUB 뷰어를 초기화하고 파일을 로드하는 자바스크립트 코드 ✨ -->
    <script th:inline="javascript">
        // Spring Boot 컨트롤러에서 Model로 넘겨받은 epCode 값을 가져오기
        // Thymeleaf의 인라인 자바스크립트 기능으로 서버에서 온 ${epCode} 값이 여기에 찍힐 거야!
        const epCode = $("#epCode").val();
        alert(epCode);

        // EPUB 파일 데이터에 접근할 URL 생성
        // 이 URL이 바로 "@GetMapping("/files/epub/{ep_code}")" 매핑 주소야!
        // Epub.js는 이 주소로 HTTP GET 요청을 보내서 EPUB 파일 데이터를 받아올 거야!
        const epubFileUrl = "/files/epub/" + epCode; // 예시: "/files/epub/P00623001001"

        console.log("EPUB 파일을 가져올 URL:", epubFileUrl); // 개발자 도구 콘솔에서 확인해봐!

        // Epub.js 초기화 및 뷰어가 표시될 div에 연결
        // Epub(epubFileUrl) <--- 여기서 아까 만든 epubFileUrl 주소로 EPUB 파일 데이터를 요청해!
        const book = new Epub(epubFileUrl);

        // 렌더링 설정 - 스크롤 방식으로!
        const rendition = book.renderTo("epub-area", { // "epub-area"는 EPUB 내용을 보여줄 div의 id
            width: "100%",
            height: "100%", // div의 높이에 꽉 채우고 div 자체를 스크롤
            // flow: "scrolled", // Epub.js 설정 (버전에 따라 다를 수 있음)
            // manager: "continuous" // Epub.js 설정 (버전에 따라 다를 수 있음)
             flow: "scrolled-doc", // ✨ 스크롤 모드! Epub.js v0.3 이후 버전에서 문서 전체 스크롤에 적합 ✨
             manager: "default" // flow가 scrolled-doc일 때 기본 매니저 사용
        });

        // 책 로드 및 표시 명령
        rendition.display();

        // * 추가 기능 (선택 사항): 글자 크기 조절 버튼, 목차 버튼, 스크롤 위치 저장 등은
        // 이 아래에 자바스크립트 코드로 계속 추가하면 돼!
        // 예: 글자 크기 조절
        // document.getElementById("increase-font-size").addEventListener("click", function() {
        //     rendition.themes.fontSize("1.2em"); // 글자 크기를 1.2em으로 설정
        // });

    </script>

    <!-- 추가 UI 요소들 (목차, 설정 버튼 등)을 여기에 추가할 수 있어 -->
    <!-- <button id="increase-font-size">글자 크게</button> -->
    <!-- <div id="toc-area"></div> -->

</body>
</html>
