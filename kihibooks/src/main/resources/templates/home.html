<!DOCTYPE html>
<html 
	xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout.html}">

<head>
	<meta charset="UTF-8">
	<title>KiHiBooks</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
	<style>
		/* 메인 배너 */
		.swiper {
			width: 100%; height: 500px;
			border-radius: 16px; padding: 20px;
			overflow: hidden;
		}
		.swiper-slide img {
			width: 100%; height: 100%;
			object-fit: cover;
		}
		/* 버튼 : 신작 / 베스트 / 매일랜덤티켓 / 키다무 / 출석체크 */
		.button-container{
			display: flex; justify-content: center; flex-wrap: wrap;
			gap: 20px; padding: 20px 0; margin: 20px;
		}
		.button-wrapper{
			display: flex; flex-direction: column;
			margin: 10px; text-decoration: none !important;
			align-items: center; text-align: center;
		}
		.button-wrapper,
		.button-wrapper:link,
		.button-wrapper:visited,
		.button-wrapper:hover,
		.button-wrapper:active {
			text-decoration: none !important;
			color: inherit !important;
		}
		.round-button{
			background-color: #f0f0f0;
			border: none; border-radius: 50%;
			width: 70px; height: 70px;
			display: flex; justify-content: center; align-items: center;
			cursor: pointer;
		}
		.button-icon{
			width: 20px; height: 20px; object-fit: contain;
		}
		.button-text{
			margin-top: 8px; font-size: 13px; font-weight: bold;
		}
		/* 실시간 랭킹 */
		.ranking-body {
			position: relative;
			display: flex;
			align-items: center;
			justify-content: center;
			max-width: 900px;
			margin: 0 auto;
			padding: 0 24px;
		}
		.book-grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 20px;
		}
		.ranking-container h2{
			text-align: center; margin-bottom: 30px;
		}

		.book-item {
			display: flex;
			align-items: center;
			gap: 12px;
			position: relative;
			background: #fff;
			padding: 6px 0;
			border-bottom: 1px solid #eee;
		}

		/* 썸네일 */
		.ranking-thumb {
			position: relative;
			width: 80px;
			height: 116px;
			flex-shrink: 0;
			border-radius: 4px;
			overflow: hidden;
			background-color: #f2f2f2;
		}

		.ranking-thumb img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			display: block;
		}

		/* 순위 넘버 */
		.ranking-number {
			font-size: 20px;
			font-weight: bold;
			color: #333;
			width: 24px;
			text-align: center;
			margin-top: 4px;
		}

		/* 도서 정보 */
		.ranking-info {
			flex-grow: 1;
		}

		.book-title {
			font-size: 15px;
			font-weight: bold;
			color: #111;
			margin-bottom: 4px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}

		.book-meta {
			font-size: 13px;
			color: #666;
			margin-bottom: 4px;
		}

		.book-rating {
			font-size: 13px;
			color: #d00;
		}
		.side-nav {
			position: absolute;
			top: 50%;
			transform: translateY(-50%);
			background-color: white;
			border: 1px solid #ccc;
			border-radius: 50%;
			width: 36px;
			height: 36px;
			font-size: 20px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			box-shadow: 0 0 4px rgba(0,0,0,0.1);
			transition: background-color 0.2s ease;
		}

		.side-nav:hover {
			background-color: #f7f7f7;
			border-color: #999;
		}

		.side-nav.left {
			left: -48px; /* 버튼이 왼쪽으로 조금 튀어나오게 */
		}

		.side-nav.right {
			right: -48px;
		}

  	</style>
</head>

<body>
	<div layout:fragment="content" class="container">
		<!-- 메인 배너 -->
		<div class="swiper">
			<div class="swiper-wrapper">
				<div class="swiper-slide" th:each="img : ${banners}">
					<img th:src="@{/resources/static{path}(path=${img})}" alt="배너"> <!--@{${img}}-->
				</div>
			</div>
			<div class="swiper-button-next"></div>
			<div class="swiper-button-prev"></div>
			<div class="swiper-pagination"></div>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
		<script>
			window.addEventListener('DOMContentLoaded', function(){
				const swiper = new Swiper('.swiper', {
					loop: true,
					autoplay: {
						delay: 3000,
					},
					pagination: {
						el: '.swiper-pagination',
						clickable: true,
					},
					navigation: {
						nextEl: '.swiper-button-next',
						prevEl: '.swiper-button-prev',
					},
				});
			})
		</script>
		<!-- 버튼 : 신작 / 베스트 / 매일랜덤티켓 / 키다무 / 출석체크 -->
		<div class="button-container">
			<a th:href="@{/}" class="button-wrapper">
				<div class="round-button">
					<img src="/resources/static/img/N.png" alt="신작" class="button-icon">
				</div>
				<div class="button-text">신작</div>
			</a>
			<a th:href="@{/}" class="button-wrapper">
				<div class="round-button">
					<img src="/resources/static/img/best.png" alt="베스트" class="button-icon">
				</div>
				<div class="button-text">베스트</div>
			</a>
			<a th:href="@{/}" class="button-wrapper">
				<div class="round-button">
					<img src="/resources/static/img/ticket.png" alt="매일랜덤티켓" class="button-icon">
				</div>
				<div class="button-text">매일랜덤티켓</div>
			</a>
			<a th:href="@{/}" class="button-wrapper">
				<div class="round-button">
					<img src="/resources/static/img/clock.png" alt="키다무" class="button-icon">
				</div>
				<div class="button-text">키다무</div>
			</a>
			<a th:href="@{/}" class="button-wrapper">
				<div class="round-button">
					<img src="/resources/static/img/calendar.png" alt="출석체크" class="button-icon">
				</div>
				<div class="button-text">출석체크</div>
			</a>
		</div>
		<!-- 실시간 랭킹 -->
		<div class="ranking-container">
			<h2>실시간 랭킹</h2>
			<div class="ranking-body">
				<button id="prevBtn" onclick="prevPage()" class="side-nav left"><</button>

				<div id="bookGrid" class="book-grid"></div>
				
				<button id="nextBtn" onclick="nextPage()" class="side-nav right">></button>
			</div>
			<script>
				let books =[];
				let currentPage = 0;
				const pageSize = 9;
				loadBooks();

				function loadBooks() {
					$.ajax({
						url: '/realtime',
						method: 'GET',
						dataType: 'json',
						success: function(data){
							books = data;
							renderBooks();
						},
						error: function(xhr, status,error){
							console.error("데이터 요청 실패", status, error);
						}
					});
				}

				function updateNavButtons(){
					document.getElementById("prevBtn").disabled = currentPage === 0;
					document.getElementById("nextBtn").disabled = (currentPage + 1) * pageSize >= books.length;

				}

				function renderBooks(){
					const grid = document.getElementById("bookGrid");
					grid.innerHTML = "";

					const start = currentPage * pageSize;
					const end = start + pageSize;
					const pageBooks = books.slice(start, end);


					pageBooks.forEach((book, index) =>{
						
						const bookDiv = document.createElement("div");
						bookDiv.className = "book-item";

						const imageNum = start + index + 1;
						const imageUrl = `/resources/static/covers/cover${imageNum}.png`;

						bookDiv.innerHTML = `
							<div class="ranking-thumb">
							<img src = "${imageUrl}" alt = "${book.bo_title}" width="80" height="116"/>
							</div>
							<div class="ranking-number">${imageNum}</div>
							<div class="ranking-info">
								<div class="book-title">${book.bo_title}</div>
								<div class="book-meta">${book.bo_author || '작가 미정'} · ${book.bo_free_info || '무료'}</div>
								<div class="book-rating">
									★${book.bo_total_rating / 1000} |	리뷰 ${book.bo_review_count}
								</div>
							</div>
						`;
						grid.appendChild(bookDiv);
					});
					updateNavButtons();
				}
				
				function nextPage() {
					if ((currentPage + 1) * pageSize < books.length) {
					currentPage++;
					renderBooks();
					}
				}

				function prevPage() {
					if (currentPage > 0) {
					currentPage--;
					renderBooks();
					}
				}
			</script>
		</div>




	</div>
</body>

</html>