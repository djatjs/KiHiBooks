<!DOCTYPE html>
<html 
	xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout.html}">

<head>
	<meta charset="UTF-8">
	<title>KiHiBooks</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
	<style>
		/* 메인 배너 */
		.swiper {
			width: 100%; height: 500px;
			border-radius: 16px; padding: 20px;
			overflow: hidden;
		}
		.swiper-slide img {
			width: 100%; height: 100%;
			object-fit: cover;
		}
		/* 버튼 : 신작 / 베스트 / 매일랜덤티켓 / 키다무 / 출석체크 */
		.button-container{
			display: flex; justify-content: center; flex-wrap: wrap;
			gap: 20px; padding: 20px 0; margin: 20px;
		}
		.button-wrapper{
			display: flex; flex-direction: column;
			margin: 10px; text-decoration: none !important;
			align-items: center; text-align: center;
		}
		.button-wrapper,
		.button-wrapper:link,
		.button-wrapper:visited,
		.button-wrapper:hover,
		.button-wrapper:active {
			text-decoration: none !important;
			color: inherit !important;
		}
		.round-button{
			background-color: #f0f0f0;
			border: none; border-radius: 50%;
			width: 70px; height: 70px;
			display: flex; justify-content: center; align-items: center;
			cursor: pointer;
		}
		.button-icon{
			width: 20px; height: 20px; object-fit: contain;
		}
		.button-text{
			margin-top: 8px; font-size: 13px; font-weight: bold;
		}
		/* 실시간 랭킹 */
		.ranking-container{
			width: 720px; margin: 30px auto; text-align: center;
		}
		.book-grid{
			display: grid; gap: 20px; margin-bottom: 20px;
			grid-template-columns: repeat(3, 1fr);
		}
		.book-card{
			border: 1px solid #ccc; padding: 10px; border-radius: 8px;
		}
		.book-card img{
			width: 100%; object-fit: cover; border-radius: 4px;
		}
		.book-title{
			margin-top: 8px; font-weight: bold;
		}
		.nav-buttons{
			display: flex; justify-content: flex-end; 
			margin-top: 10px; gap: 8px;
		}
		.nav-buttons button {
			background-color: white;
			border: 1px solid #ccc;
			color: #333;
			padding: 8px 16px;
			font-size: 14px;
			border-radius: 4px;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.nav-buttons button:hover {
			border-color: #999;
			color: #111;
			background-color: #f9f9f9;
		}

		.nav-buttons button:disabled {
			color: #aaa;
			border-color: #ddd;
			cursor: default;
			background-color: #f5f5f5;
		}
  	</style>
</head>

<body>
	<div layout:fragment="content" class="container">
		<!-- 메인 배너 -->
		<div class="swiper">
			<div class="swiper-wrapper">
				<div class="swiper-slide" th:each="img : ${banners}">
					<img th:src="@{/resources/static{path}(path=${img})}" alt="배너"> <!--@{${img}}-->
				</div>
			</div>
			<div class="swiper-button-next"></div>
			<div class="swiper-button-prev"></div>
			<div class="swiper-pagination"></div>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
		<script>
			window.addEventListener('DOMContentLoaded', function(){
				const swiper = new Swiper('.swiper', {
					loop: true,
					autoplay: {
						delay: 3000,
					},
					pagination: {
						el: '.swiper-pagination',
						clickable: true,
					},
					navigation: {
						nextEl: '.swiper-button-next',
						prevEl: '.swiper-button-prev',
					},
				});
			})
		</script>
		<!-- 버튼 : 신작 / 베스트 / 매일랜덤티켓 / 키다무 / 출석체크 -->
		<div class="button-container">
			<a th:href="@{/}" class="button-wrapper">
				<div class="round-button">
					<img src="/resources/static/img/N.png" alt="신작" class="button-icon">
				</div>
				<div class="button-text">신작</div>
			</a>
			<a th:href="@{/}" class="button-wrapper">
				<div class="round-button">
					<img src="/resources/static/img/best.png" alt="베스트" class="button-icon">
				</div>
				<div class="button-text">베스트</div>
			</a>
			<a th:href="@{/}" class="button-wrapper">
				<div class="round-button">
					<img src="/resources/static/img/ticket.png" alt="매일랜덤티켓" class="button-icon">
				</div>
				<div class="button-text">매일랜덤티켓</div>
			</a>
			<a th:href="@{/}" class="button-wrapper">
				<div class="round-button">
					<img src="/resources/static/img/clock.png" alt="키다무" class="button-icon">
				</div>
				<div class="button-text">키다무</div>
			</a>
			<a th:href="@{/}" class="button-wrapper">
				<div class="round-button">
					<img src="/resources/static/img/calendar.png" alt="출석체크" class="button-icon">
				</div>
				<div class="button-text">출석체크</div>
			</a>
		</div>
		<!-- 실시간 랭킹 -->
		<div class="ranking-container">
			<h2>실시간 랭킹</h2>
			<div id="bookGrid" class="book-grid"></div>
			<div class="nav-buttons">
				<button onclick="prevPage()">이전</button>
				<button onclick="prevPage()">다음</button>
			</div>
			<script>
				let books =[];
				let currentPage = 0;
				const pageSize = 9;
				loadBooks();

				function loadBooks() {
					$.ajax({
						url: '/realtime',
						method: 'GET',
						dataType: 'json',
						success: function(data){
							console.log("서버에서 받은 데이터", data);
							books = data;
							renderBooks();
						},
						error: function(xhr, status,error){
							console.error("데이터 요청 실패", status, error);
						}
					});
				}

				function renderBooks(){
					console.log("renderBooks 호출됨", currentPage);

					const grid = document.getElementById("bookGrid");
					grid.innerHTML = "";

					const start = currentPage * pageSize;
					const end = start + pageSize;
					const pageBooks = books.slice(start, end);

					console.log(pageBooks.length);

					pageBooks.forEach((book, index) =>{
						console.log(book.bo_title);

						const bookDiv = document.createElement("div");
						bookDiv.className = "book-item";

						bookDiv.innerHTML = `
							<img 
								src = "/resources/static/covers/cover1.png"
								alt = "${book.bo_title}" width="80" height="116"
							/>
							<div class="book-title">${book.bo_title}</div>
							<div class="book-rating">
								★${book.bo_total_rating / 1000} |
								리뷰 ${book.bo_review_count}
							</div>
						`;
						grid.appendChild(bookDiv);
					});
				}
				
				function nextPage() {
					if ((currentPage + 1) * pageSize < books.length) {
					currentPage++;
					renderBooks();
					}
				}

				function prevPage() {
					if (currentPage > 0) {
					currentPage--;
					renderBooks();
					}
				}
			</script>
		</div>





	</div>
</body>

</html>