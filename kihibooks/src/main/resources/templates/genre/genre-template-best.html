<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout.html}">

<head>
  <meta charset="UTF-8">
  <title>ë² ìŠ¤íŠ¸ - ì¥ë¥´ë³„</title>
  <link rel="stylesheet" th:href="@{/css/book-tab-best.css}">
</head>

<body>
<section class="container" layout:fragment="content">
  <!-- ğŸ”µ í•„í„° ì˜ì—­ -->
  <div class="filter-header">
    <div class="sort-options">
      <a th:href="@{'?tab=best&range=day' + ${extraParams}}"
         class="sort-option"
         th:classappend="${range} == 'day' ? ' active'">ì˜¤ëŠ˜ì˜ ë² ìŠ¤íŠ¸</a>
      <a th:href="@{'?tab=best&range=week' + ${extraParams}}"
         class="sort-option"
         th:classappend="${range} == 'week' ? ' active'">ì£¼ê°„ ë² ìŠ¤íŠ¸</a>
      <a th:href="@{'?tab=best&range=month' + ${extraParams}}"
         class="sort-option"
         th:classappend="${range} == 'month' ? ' active'">ì›”ê°„ ë² ìŠ¤íŠ¸</a>
    </div>
    <div class="filter-options">
      <label><input type="checkbox" id="adultY" th:checked="${adultYN} == 'Y'"> ì„±ì¸ì‘í’ˆë§Œ</label>
      <label><input type="checkbox" id="adultN" th:checked="${adultYN} == 'N'"> ì„±ì¸ì‘í’ˆ ì œì™¸</label>
      <label><input type="checkbox" id="finished" th:checked="${finished} == 'Y'"> ì™„ê²°ì‘í’ˆë§Œ</label>
    </div>
  </div>

  <!-- ğŸ“š ë„ì„œ ë¦¬ìŠ¤íŠ¸ -->
  <div class="book-grid">
    <div class="book-card" th:each="book : ${pageInfo.content}">
      <a th:href="@{/books/{id}(id=${book.bo_code})}" class="thumb-wrapper">
        <img th:src="@{/resources/static/img/default_thumb.png}" alt="ì¸ë„¤ì¼">
        <span class="badge adult-badge" th:if="${book.bo_adult == 'Y'}">19</span>
      </a>
      <p class="book-title">
        <a th:href="@{/books/{id}(id=${book.bo_code})}" th:text="${book.bo_title}">ì±… ì œëª©</a>
      </p>
      <p class="book-author">
        <a th:href="@{/author/{id}(id=${book.bo_au_num})}" th:text="${book.bo_author}">ì‘ê°€ëª…</a>
      </p>
      <p class="book-meta">
        <span th:text="'ì´ ' + ${book.bo_total_episode} + 'í™”'"></span>
        <span class="badge fin-badge" th:if="${book.bo_fin == 'Y'}">ì™„ê²°</span>
      </p>
      <p class="book-meta">
        <span class="highlight-rating"
              th:text="'â˜… ' + (${book.bo_review_count} > 0 ? ${#numbers.formatDecimal((book.bo_total_rating / book.bo_review_count) / 2, 1, 1)} : '0.0')"></span>
        <span>|</span>
        <span th:text="'(' + ${book.bo_review_count} + ')'"></span>
      </p>
    </div>
  </div>

  <!-- â© í˜ì´ì§€ë„¤ì´ì…˜ -->
  <div class="pagination">
    <a th:if="${pageInfo.currentPage > 1}"
       th:href="@{'?tab=best&sort=' + ${sort} + '&page=' + (${pageInfo.currentPage - 1}) + ${extraParams}}">ì´ì „</a>

    <a th:each="p : ${#numbers.sequence(pageInfo.startPage, pageInfo.endPage)}"
       th:href="@{'?tab=best&sort=' + ${sort} + '&page=' + ${p} + ${extraParams}}"
       th:text="${p}"
       th:classappend="${p} == ${pageInfo.currentPage} ? 'active'"></a>

    <a th:if="${pageInfo.currentPage < pageInfo.totalPages}"
       th:href="@{'?tab=best&sort=' + ${sort} + '&page=' + (${pageInfo.currentPage + 1}) + ${extraParams}}">ë‹¤ìŒ</a>
  </div>
</section>

<!-- í•„í„° ìŠ¤í¬ë¦½íŠ¸ -->
<div layout:fragment="script">
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const params = new URLSearchParams(window.location.search);
      const sort = params.get('sort') || 'day';
      const tab = 'best';

      document.getElementById('adultY')?.addEventListener('change', function () {
        if (this.checked) {
          params.set('adultYN', 'Y');
          document.getElementById('adultN').checked = false;
        } else {
          params.delete('adultYN');
        }
        redirect();
      });

      document.getElementById('adultN')?.addEventListener('change', function () {
        if (this.checked) {
          params.set('adultYN', 'N');
          document.getElementById('adultY').checked = false;
        } else {
          params.delete('adultYN');
        }
        redirect();
      });

      document.getElementById('finished')?.addEventListener('change', function () {
        if (this.checked) {
          params.set('finished', 'Y');
        } else {
          params.delete('finished');
        }
        redirect();
      });

      function redirect() {
        params.set('tab', tab);
        params.set('sort', sort);
        params.set('page', 1);
        location.href = '?' + params.toString();
      }
    });
  </script>
</div>
</body>
</html>
